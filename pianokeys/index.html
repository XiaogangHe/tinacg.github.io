<!DOCTYPE html>
<html>
  <head>
	<style>
	  canvas {
	  border: 2px solid #CCCCCC;
	  margin: 20px;
	</style>
  </head>
  <body>
	<canvas id="piano" width="600" height="300"></canvas>
	<script>
          //

        var pianoElem = document.getElementById('piano');
        var pianoOffsetLeft = pianoElem.offsetLeft;
        var pianoOffsetTop = pianoElem.offsetTop;
        var context = pianoElem.getContext('2d');
        var keys = [];
        var plainWidth = 20;
        var plainHeight = 120;
        var sharpWidth = 14;
        var sharpHeight = 75;
        var sharpWidthOffset = 2;

        function Key(i) {
          var sharps = [1, 3, 6, 8, 10];
          var names = ['C', 'C#', 'D', 'D#', 'E', 'F', 'F#', 'G', 'G#', 'A', 'A#', 'B']
          var offsets = [0, 0.5, 1, 1.5, 2, 3, 3.5, 4, 4.5, 5, 5.5, 6];
          var leftMargin = 15;
          var topMargin = 15;
          
          this.index = i;
          this.name = names[i % 12];
          this.selected = false;
          
          this.isSharp = sharps.indexOf(this.index % 12) > -1;

          this.left = leftMargin + (offsets[i % 12] * plainWidth) + (Math.floor(i / 12) * 7 * plainWidth);
          this.top = topMargin;

          if (this.isSharp) {
            this.left += sharpWidthOffset;
            this.width = sharpWidth;
            this.height = sharpHeight;
          } else {
            this.width = plainWidth;
            this.height = plainHeight;
          }
        }

        Key.prototype.draw = function() {
          var plainColor = "#FFFFFF";
          var plainSelectedColor = "#AAEE99";
          var sharpColor = "#000000";
          var sharpSelectedColor = "#116600";

          var strokeColor = "#CCCCCC";
          var fillColor = "#FFFFFF";

          if (this.isSharp) {
            if (this.selected) {
              fillColor = sharpSelectedColor;
            } else {
              fillColor = sharpColor;
            }
          } else {
            if (this.selected) {
              fillColor = plainSelectedColor;
            } else {
              fillColor = plainColor;
            }
          }

          context.beginPath();
          context.rect(this.left, this.top, this.width, this.height);
          context.fillStyle = fillColor;
          context.fill();
          context.lineWidth = 2;
          context.strokeStyle = strokeColor;
          context.stroke();
        }

        for (var i = 0; i < 24; i++) {
          keys.push(new Key(i));
        }
        
        function redraw() {
          // draw plain keys first, then sharps
          keys.forEach(function(key) {
            if (!key.isSharp) {
              key.draw();
            }
          });

          keys.forEach(function(key) {
            if (key.isSharp) {
              key.draw();
            }
          });
        }

        redraw();

        pianoElem.addEventListener('click', function(e) {
          var x = e.pageX - pianoOffsetLeft;
          var y = e.pageY - pianoOffsetTop;

          console.log(x);
          
          keys.forEach(function(key) {
            // sharps
            if (y > key.top && y < key.top + sharpHeight && key.isSharp && 
                x > key.left && x < key.left + key.width) {
              console.log("clicked on sharp " + key.name);
              key.selected = !key.selected;
            } else if (y > key.top + sharpHeight && y < key.top + key.height && x > key.left && x < key.left + key.width) {
              console.log("clicked on plain " + key.name);
              key.selected = !key.selected;
            }
          });

          redraw();
        }, false);
	    
	</script>
  </body>
</html>
